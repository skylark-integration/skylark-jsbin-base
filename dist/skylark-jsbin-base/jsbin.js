/**
 * skylark-jsbin-base - A version of jsbin-client  that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-jsbin-base/
 * @license MIT
 */
define(["skylark-langx-ns","skylark-langx-objects","skylark-jquery","./storage"],function(e,t,n,a){"use strict";var s=e.attach("intg.jsbin");window.jsbin&&(t.mixin(s,window.jsbin),window.jsbin=s);try{console.log("Dave is ready.")}catch(e){window.console={log:function(){},warn:function(){},trace:function(){},error:function(){}}}function i(e,t){var n=function(){var a=this,s=arguments;n.cancel(),n.timer=setTimeout(function(){e.apply(a,s)},t)};return n.cancel=function(){clearTimeout(n.timer)},n}n.expr[":"].host=function(e,t,n){return e.host===n[3]};var o=a.localStorage.getItem("settings");("undefined"===o||s.embed)&&(o=null),s.user&&s.user.name?(s.settings=n.extend(!0,{},s.user.settings,s.settings),s.user.settings.font&&(s.settings.font=parseInt(s.user.settings.font,10))):s.settings=n.extend({},s.settings,JSON.parse(o||"{}")),s.mobile=/WebKit.*Mobile.*|Android/.test(navigator.userAgent),s.tablet=/iPad/i.test(navigator.userAgent),s.ie=function(){for(var e=3,t=document.createElement("div"),n=t.getElementsByTagName("i");t.innerHTML="\x3c!--[if gt IE "+ ++e+"]><i></i><![endif]--\x3e",n[0];);return e>4?e:void 0}(),o||location.origin+location.pathname!==s.root+"/"||a.localStorage.setItem("settings","{}"),s.settings.editor||(s.settings.editor={}),s.settings.codemirror&&n.extend(s.settings.editor,s.settings.codemirror),s.settings.editor.theme&&n(document.documentElement).addClass("cm-s-"+s.settings.editor.theme.split(" ")[0]),n.ajaxPrefilter(function(e,t,n){({head:1,get:1})[e.type.toLowerCase()]||e.url.match(/^https:\/\/api.github.com/)||n.setRequestHeader("x-csrf-token",s.state.token)}),s.owner=function(){return s.user&&s.user.name&&s.state.metadata&&s.state.metadata.name===s.user.name},s.getURL=function(e){e||(e={});var t=e.withoutRoot,n=e.root||s.root,a=t?"":n,i=s.state;return i.code&&(a+="/"+i.code,i.latest&&!e.withRevision||!1!==e.withRevision&&(a+="/"+(i.revision||1))),a},s.state.updateSettings=i(function(e,t){t||(t="POST"),s.state.code&&(e.checksum=s.state.checksum,n.ajax({type:t,url:s.getURL({withRevision:!0})+"/settings",data:e}))},500);var r,c=n(window),d=n("body"),l=n(document),u=(void 0!==s.settings.debug&&s.settings.debug,n("#bin")),g=function(){if(a.sessionStorage.setItem("url",s.getURL()),a.localStorage.setItem("settings",JSON.stringify(s.settings)),!1!==s.panels.saveOnExit){s.panels.save(),s.panels.savecontent();var e=s.panels.focused;e&&a.sessionStorage.setItem("panel",e.id)}};return c.unload(g),n.browser.opera&&setInterval(g,500),l.one("jsbinReady",function(){u.removeAttr("style"),d.addClass("ready")}),-1!==navigator.userAgent.indexOf(" Mac ")&&((r=n("#keyboardHelp")[0]).innerHTML=r.innerHTML.replace(/ctrl/g,"cmd").replace(/Ctrl/g,"ctrl")),s.embed&&c.on("focus",function(){return!1}),window.addEventListener("message",function(e){var t;try{t=JSON.parse(e.data)}catch(e){return}"cached"===t.type&&(t.updated>s.state.metadata.last_updated||!s.state.metadata.last_updated)&&(console.log("restored from cache: %sms newer",(new Date(t.updated).getTime()-new Date(s.state.metadata.last_updated).getTime())/100),s.panels.panels.html.setCode(t.template.html),s.panels.panels.javascript.setCode(t.template.javascript),s.panels.panels.css.setCode(t.template.css),n("a.save:first").click())}),function(){if(s.settings.debug){var e=document.createElement("pre");document.body.appendChild(e),e.tabindex=-1,t.mixin(e.style,{position:"fixed",padding:"2px",bottom:"20px",right:"20px",margin:0,fontSize:12,color:"#fff",background:"#aaa",whiteSpace:"pre-wrap",maxWidth:"95%",zIndex:1e7,pointerEvents:"none"});var n=null,a=function(){var t=document.activeElement,s="",i=t.attributes,o=0;if(t!==n&&t!==e){for(;o<i.length;o++)s+=" "+i[o].name+'="'+i[o].value+'"';e.textContent="<"+t.nodeName.toLowerCase()+s+">",n=t}requestAnimationFrame(a)};a()}}(),s.$document=l,s.$window=c,s.throttle=i,s.escapeHTML=function(e){return String(e).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},s});
//# sourceMappingURL=sourcemaps/jsbin.js.map
