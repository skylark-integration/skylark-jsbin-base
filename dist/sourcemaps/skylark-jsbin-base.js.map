{"version":3,"sources":["skylark-jsbin-base.js"],"names":["define","$","hasStore","type","window","e","sessionStorage","localStorage","data","keys","length","s","polyfill","name","JSON","parse","Object","key","i","clear","getItem","removeItem","stringify","setItem","value","forEach","extend","skylark","objects","store","jsbin","attach","mixin","console","log","warn","trace","error","throttle","fn","delay","throttled","context","this","args","arguments","cancel","timer","setTimeout","apply","clearTimeout","expr","host","obj","index","meta","storedSettings","embed","user","settings","font","parseInt","mobile","test","navigator","userAgent","tablet","ie","v","div","document","createElement","all","getElementsByTagName","innerHTML","undef","location","origin","pathname","root","editor","codemirror","theme","documentElement","addClass","split","ajaxPrefilter","options","original","xhr","head","get","toLowerCase","url","match","setRequestHeader","state","token","owner","metadata","getURL","withoutRoot","code","latest","withRevision","revision","updateSettings","update","method","checksum","ajax","el","$window","$body","$document","$bin","undefined","debug","unload","panels","saveOnExit","save","savecontent","panel","focused","id","browser","opera","setInterval","one","removeAttr","indexOf","replace","on","addEventListener","event","updated","last_updated","Date","getTime","html","setCode","template","javascript","css","click","active","body","appendChild","tabindex","style","position","padding","bottom","right","margin","fontSize","color","background","whiteSpace","maxWidth","zIndex","pointerEvents","lastActive","showActive","activeElement","attrs","attributes","textContent","nodeName","requestAnimationFrame","escapeHTML","String","main"],"mappings":";;;;;;;g4BAAAA,EAAA,8BACA,kBACA,SAAAC,GACA,SAAAC,EAAAC,GACA,IACA,OAAAA,KAAAC,QAAA,OAAAA,OAAAD,GACA,MAAAE,GACA,OAAA,GAKA,IAIAC,EACAC,EAKAC,EACAC,EACAC,EAEAC,EAdAC,GAAA,EAZA,OAmBAV,EAAA,kBAuCAI,EAAAF,OAAAE,gBAtCAM,GAAA,EAEAJ,EAAAJ,OAAAS,KAAAC,KAAAC,MAAAX,OAAAS,SACAJ,EAAAO,OAAAP,KAAAD,GACAE,EAAAD,EAAAC,OAEAC,GACAM,IAAA,SAAAC,GACA,OAAAF,OAAAP,KAAAD,GAAAU,IAAA,MAEAR,OAAAA,EACAS,MAAA,WACAX,KACAJ,OAAAS,KAAA,GACAF,EAAAD,OAAA,GAEAU,QAAA,SAAAH,GACA,OAAAT,EAAAS,IAAA,MAEAI,WAAA,SAAAJ,UACAT,EAAAS,GACAb,OAAAS,KAAAC,KAAAQ,UAAAd,GACAG,EAAAD,UAEAa,QAAA,SAAAN,EAAAO,GACAhB,EAAAS,GAAAO,EACApB,OAAAS,KAAAC,KAAAQ,UAAAd,GACAG,EAAAD,WAIAD,EAAAgB,QAAA,SAAAR,GACAN,EAAAM,GAAAT,EAAAS,KA/BAX,EAkCAK,GAMAT,EAAA,gBAGAA,EAAA,kBACAK,EAAAH,OAAAG,cAFAA,EAAAN,EAAAyB,UAAApB,IA9DAM,SAAAA,EACAN,eAAAA,EACAC,aAAAA,KAMAP,EAAA,4BACA,mBACA,wBACA,iBACA,aACA,SAAA2B,EAAAC,EAAA3B,EAAA4B,GACA,aAEA,IAAAC,EAAAH,EAAAI,OAAA,cACA3B,OAAA0B,QACAF,EAAAI,MAAAF,EAAA1B,OAAA0B,OACA1B,OAAA0B,MAAAA,GAGA,IACAG,QAAAC,IAAA,kBACA,MAAA7B,GACAD,OAAA6B,SACAC,IAAA,aAGAC,KAAA,aACAC,MAAA,aACAC,MAAA,cASA,SAAAC,EAAAC,EAAAC,GACA,IAAAC,EAAA,WACA,IAAAC,EAAAC,KAAAC,EAAAC,UACAJ,EAAAK,SACAL,EAAAM,MAAAC,WAAA,WACAT,EAAAU,MAAAP,EAAAE,IACAJ,IAOA,OAJAC,EAAAK,OAAA,WACAI,aAAAT,EAAAM,QAGAN,EAjBAxC,EAAAkD,KAAA,KAAAC,KAAA,SAAAC,EAAAC,EAAAC,GACA,OAAAF,EAAAD,OAAAG,EAAA,IA2JA,IAAAC,EAAA3B,EAAAtB,aAAAa,QAAA,aACA,cAAAoC,GAAA1B,EAAA2B,SAEAD,EAAA,MAYA1B,EAAA4B,MAAA5B,EAAA4B,KAAA7C,MACAiB,EAAA6B,SAAA1D,EAAAyB,QAAA,KAAAI,EAAA4B,KAAAC,SAAA7B,EAAA6B,UACA7B,EAAA4B,KAAAC,SAAAC,OACA9B,EAAA6B,SAAAC,KAAAC,SAAA/B,EAAA4B,KAAAC,SAAAC,KAAA,MAKA9B,EAAA6B,SAAA1D,EAAAyB,UAAAI,EAAA6B,SAAA7C,KAAAC,MAAAyC,GAAA,OAIA1B,EAAAgC,OAAA,2BAAAC,KAAAC,UAAAC,WACAnC,EAAAoC,OAAA,QAAAH,KAAAC,UAAAC,WAGAnC,EAAAqC,GAAA,WAKA,IAJA,IACAC,EAAA,EACAC,EAAAC,SAAAC,cAAA,OACAC,EAAAH,EAAAI,qBAAA,KAEAJ,EAAAK,UAAA,uBAAAN,EAAA,2BACAI,EAAA,KAEA,OAAAJ,EAAA,EAAAA,OARAO,EADA,GAYAnB,GAAAoB,SAAAC,OAAAD,SAAAE,WAAAhD,EAAAiD,KAAA,KAEAlD,EAAAtB,aAAAgB,QAAA,WAAA,MAGAO,EAAA6B,SAAAqB,SAEAlD,EAAA6B,SAAAqB,WAGAlD,EAAA6B,SAAAsB,YACAhF,EAAAyB,OAAAI,EAAA6B,SAAAqB,OAAAlD,EAAA6B,SAAAsB,YAGAnD,EAAA6B,SAAAqB,OAAAE,OACAjF,EAAAqE,SAAAa,iBAAAC,SAAA,QAAAtD,EAAA6B,SAAAqB,OAAAE,MAAAG,MAAA,KAAA,IAKApF,EAAAqF,cAAA,SAAAC,EAAAC,EAAAC,KACAC,KAAA,EAAAC,IAAA,IACAJ,EAAApF,KAAAyF,gBACAL,EAAAM,IAAAC,MAAA,8BACAL,EAAAM,iBAAA,eAAAjE,EAAAkE,MAAAC,SAIAnE,EAAAoE,MAAA,WACA,OAAApE,EAAA4B,MAAA5B,EAAA4B,KAAA7C,MAAAiB,EAAAkE,MAAAG,UAAArE,EAAAkE,MAAAG,SAAAtF,OAAAiB,EAAA4B,KAAA7C,MAGAiB,EAAAsE,OAAA,SAAAb,GACAA,IAAAA,MAEA,IAAAc,EAAAd,EAAAc,YACAtB,EAAAQ,EAAAR,MAAAjD,EAAAiD,KACAc,EAAAQ,EAAA,GAAAtB,EACAiB,EAAAlE,EAAAkE,MAWA,OATAA,EAAAM,OACAT,GAAA,IAAAG,EAAAM,KAEAN,EAAAO,SAAAhB,EAAAiB,eACA,IAAAjB,EAAAiB,eACAX,GAAA,KAAAG,EAAAS,UAAA,KAIAZ,GAGA/D,EAAAkE,MAAAU,eAAApE,EAAA,SAAAqE,EAAAC,GACAA,IACAA,EAAA,QAGA9E,EAAAkE,MAAAM,OACAK,EAAAE,SAAA/E,EAAAkE,MAAAa,SACA5G,EAAA6G,MACA3G,KAAAyG,EACAf,IAAA/D,EAAAsE,QAAAI,cAAA,IAAA,YACAhG,KAAAmG,MAGA,KA6BA,IAgDAI,EAhDAC,EAAA/G,EAAAG,QACA6G,EAAAhH,EAAA,QACAiH,EAAAjH,EAAAqE,UAGA6C,QAFAC,IAAAtF,EAAA6B,SAAA0D,OAAAvF,EAAA6B,SAAA0D,MAEApH,EAAA,SAGAqH,EAAA,WAIA,GAHAzF,EAAAvB,eAAAiB,QAAA,MAAAO,EAAAsE,UACAvE,EAAAtB,aAAAgB,QAAA,WAAAT,KAAAQ,UAAAQ,EAAA6B,YAEA,IAAA7B,EAAAyF,OAAAC,WAAA,CAIA1F,EAAAyF,OAAAE,OACA3F,EAAAyF,OAAAG,cAEA,IAAAC,EAAA7F,EAAAyF,OAAAK,QACAD,GACA9F,EAAAvB,eAAAiB,QAAA,QAAAoG,EAAAE,MA+GA,OA3GAb,EAAAM,OAAAA,GAWArH,EAAA6H,QAAAC,OACAC,YAAAV,EAAA,KAGAJ,EAAAe,IAAA,aAAA,WAEAd,EAAAe,WAAA,SACAjB,EAAA7B,SAAA,YAGA,IAAApB,UAAAC,UAAAkE,QAAA,YAEApB,EAAA9G,EAAA,iBAAA,IACAyE,UAAAqC,EAAArC,UAAA0D,QAAA,QAAA,OAAAA,QAAA,QAAA,SAIAtG,EAAA2B,OACAuD,EAAAqB,GAAA,QAAA,WACA,OAAA,IAIAjI,OAAAkI,iBAAA,UAAA,SAAAC,GACA,IAAA/H,EACA,IACAA,EAAAM,KAAAC,MAAAwH,EAAA/H,MACA,MAAAH,GACA,OAGA,WAAAG,EAAAL,OACAK,EAAAgI,QAAA1G,EAAAkE,MAAAG,SAAAsC,eAAA3G,EAAAkE,MAAAG,SAAAsC,gBACAxG,QAAAC,IAAA,mCAAA,IAAAwG,KAAAlI,EAAAgI,SAAAG,UAAA,IAAAD,KAAA5G,EAAAkE,MAAAG,SAAAsC,cAAAE,WAAA,KAEA7G,EAAAyF,OAAAA,OAAAqB,KAAAC,QAAArI,EAAAsI,SAAAF,MACA9G,EAAAyF,OAAAA,OAAAwB,WAAAF,QAAArI,EAAAsI,SAAAC,YACAjH,EAAAyF,OAAAA,OAAAyB,IAAAH,QAAArI,EAAAsI,SAAAE,KACA/I,EAAA,gBAAAgJ,WAKA,WACA,GAAAnH,EAAA6B,SAAA0D,MAAA,CAIA,IAAA6B,EAAA5E,SAAAC,cAAA,OACAD,SAAA6E,KAAAC,YAAAF,GACAA,EAAAG,UAAA,EACAzH,EAAAI,MAAAkH,EAAAI,OACAC,SAAA,QACAC,QAAA,MACAC,OAAA,OACAC,MAAA,OACAC,OAAA,EACAC,SAAA,GACAC,MAAA,OACAC,WAAA,OACAC,WAAA,WACAC,SAAA,MACAC,OAAA,IACAC,cAAA,SAGA,IAAAC,EAAA,KACAC,EAAA,WACA,IAAArD,EAAAzC,SAAA+F,cACAzB,EAAA,GACA0B,EAAAvD,EAAAwD,WACArJ,EAAA,EAEA,GAAA6F,IAAAoD,GAAApD,IAAAmC,EAAA,CACA,KAAAhI,EAAAoJ,EAAA5J,OAAAQ,IACA0H,GAAA,IAAA0B,EAAApJ,GAAAL,KAAA,KAAAyJ,EAAApJ,GAAAM,MAAA,IAGA0H,EAAAsB,YAAA,IAAAzD,EAAA0D,SAAA7E,cAAAgD,EAAA,IACAuB,EAAApD,EAGA2D,sBAAAN,IAGAA,KA1CA,GA+CAtI,EAAAoF,UAAAA,EACApF,EAAAkF,QAAAA,EACAlF,EAAAQ,SAAAA,EACAR,EAAA6I,WAhXA,SAAA/B,GACA,OAAAgC,OAAAhC,GACAR,QAAA,aAAA,SACAA,QAAA,KAAA,QACAA,QAAA,KAAA,QACAA,QAAA,KAAA,WA8WAtG,IAKA9B,EAAA,2BACA,WACA,SAAA8B,GACA,OAAAA,IAEA9B,EAAA,sBAAA,2BAAA,SAAA6K,GAAA,OAAAA","file":"../skylark-jsbin-base.js","sourcesContent":["define('skylark-jsbin-base/storage',[\r\n  \"skylark-jquery\"\r\n],function ($) {\r\n  function hasStore(type) {\r\n    try {\r\n      return type in window && window[type] !== null;\r\n    } catch(e) {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  \"use strict\";\r\n  var polyfill = false;\r\n\r\n  // Firefox with Cookies disabled triggers a security error when we probe window.sessionStorage\r\n  // currently we're just disabling all the session features if that's the case.\r\n  var sessionStorage;\r\n  var localStorage;\r\n\r\n  if (!hasStore('sessionStorage')) {\r\n    polyfill = true;\r\n    sessionStorage = (function () {\r\n      var data = window.name ? JSON.parse(window.name) : {};\r\n      var keys = Object.keys(data);\r\n      var length = keys.length;\r\n\r\n      var s = {\r\n        key: function (i) {\r\n          return Object.keys(data)[i] || null;\r\n        },\r\n        length: length,\r\n        clear: function () {\r\n          data = {};\r\n          window.name = '';\r\n          s.length = 0;\r\n        },\r\n        getItem: function (key) {\r\n          return data[key] || null;\r\n        },\r\n        removeItem: function (key) {\r\n          delete data[key];\r\n          window.name = JSON.stringify(data);\r\n          s.length--;\r\n        },\r\n        setItem: function (key, value) {\r\n          data[key] = value;\r\n          window.name = JSON.stringify(data);\r\n          s.length++;\r\n        }\r\n      };\r\n\r\n      keys.forEach(function (key) {\r\n        s[key] = data[key];\r\n      });\r\n\r\n      return s;\r\n    })();\r\n  } else {\r\n    sessionStorage = window.sessionStorage;\r\n  }\r\n\r\n  if (!hasStore('localStorage')) {\r\n    // dirty, but will do for our purposes\r\n    localStorage = $.extend({}, sessionStorage);\r\n  } else if (hasStore('localStorage')) {\r\n    localStorage = window.localStorage;\r\n  }\r\n\r\n  /*\r\n  if (!jsbin.embed && polyfill) {\r\n    $(document).one('jsbinReady', function () {\r\n      $(document).trigger('tip', {\r\n        type: 'error',\r\n        content: 'JS Bin uses cookies to protect against CSRF attacks, so with cookies disabled, you will not be able to save your work'\r\n      });\r\n    });\r\n    jsbin.saveDisabled = true;\r\n    jsbin.sandbox = true;\r\n  }\r\n  */\r\n\r\n  return { \r\n    polyfill: polyfill, \r\n    sessionStorage: sessionStorage, \r\n    localStorage: localStorage \r\n  };\r\n\r\n});\r\n\r\n\ndefine('skylark-jsbin-base/jsbin',[\r\n  \"skylark-langx-ns\",\r\n  \"skylark-langx-objects\",\r\n  \"skylark-jquery\",\r\n  \"./storage\"\r\n],function(skylark,objects,$,store){\r\n  'use strict';\r\n\r\n  var jsbin = skylark.attach(\"intg.jsbin\");\r\n  if (window.jsbin) {\r\n    objects.mixin(jsbin,window.jsbin);\r\n    window.jsbin = jsbin;\r\n  }\r\n\r\n  try {\r\n    console.log('Dave is ready.');\r\n  } catch (e) {\r\n    window.console = {\r\n      log: function () {\r\n        // alert([].slice.call(arguments).join('\\n'));\r\n      },\r\n      warn: function () {},\r\n      trace: function () {},\r\n      error: function () {}\r\n    };\r\n  }\r\n\r\n  // required because jQuery 1.4.4 lost ability to search my object property :( (i.e. a[host=foo.com])\r\n  $.expr[':'].host = function(obj, index, meta) {\r\n    return obj.host === meta[3];\r\n  };\r\n\r\n  function throttle(fn, delay) {\r\n    var throttled = function () {\r\n      var context = this, args = arguments;\r\n      throttled.cancel();\r\n      throttled.timer = setTimeout(function () {\r\n        fn.apply(context, args);\r\n      }, delay);\r\n    };\r\n\r\n    throttled.cancel = function () {\r\n      clearTimeout(throttled.timer);\r\n    };\r\n\r\n    return throttled;\r\n  }\r\n\r\n  function debounceAsync(fn) {\r\n    'use strict';\r\n    var waiting = false;\r\n    var last = null;\r\n\r\n    return function debouceRunner() {\r\n      var args = [].slice.call(arguments, 0);\r\n      // console.time('tracker');\r\n\r\n      var tracker = function () {\r\n        waiting = false;\r\n          // console.timeEnd('tracker');\r\n        if (last) {\r\n          // console.log('applying the last');\r\n          fn.apply(last.context, last.args);\r\n          // console.log('and now clear');\r\n          last = null;\r\n        }\r\n      };\r\n\r\n      // put the tracker in place of the callback\r\n      args.push(tracker);\r\n\r\n      if (!waiting) {\r\n        // console.log('running this time...');\r\n        waiting = true;\r\n        return fn.apply(this, args);\r\n      } else {\r\n        // console.log('going to wait...');\r\n        last = { args: args, context: this };\r\n      }\r\n    };\r\n  }\r\n\r\n  function escapeHTML(html){\r\n    return String(html)\r\n      .replace(/&(?!\\w+;)/g, '&amp;')\r\n      .replace(/</g, '&lt;')\r\n      .replace(/>/g, '&gt;')\r\n      .replace(/\"/g, '&quot;');\r\n  }\r\n\r\n  function dedupe(array) {\r\n    var hash    = {},\r\n        results = [],\r\n        hasOwn  = Object.prototype.hasOwnProperty,\r\n        i, item, len;\r\n\r\n    for (i = 0, len = array.length; i < len; i += 1) {\r\n      item = array[i];\r\n\r\n      if (!hasOwn.call(hash, item)) {\r\n        hash[item] = 1;\r\n        results.push(item);\r\n      }\r\n    }\r\n\r\n    return results;\r\n  }\r\n\r\n  function isDOM(obj) {\r\n    'use strict';\r\n    var Node = window.Node || false;\r\n    if (Node) {\r\n      return obj instanceof Node;\r\n    }\r\n    return obj.nodeType === 1;\r\n  }\r\n\r\n  /*\r\n  function exposeSettings() {\r\n    'use strict';\r\n\r\n    function mockEditor (editor, methods) {\r\n      return methods.reduce(function (mockEditor, method) {\r\n        mockEditor[method] = editor[method].bind(editor);\r\n        return mockEditor;\r\n      }, {});\r\n    }\r\n\r\n    function mockPanels() {\r\n      var results = {};\r\n      var panels = jsbin.panels.panels;\r\n      ['css', 'javascript', 'html'].forEach(function (type) {\r\n        results[type] = {\r\n          setCode: panels[type].setCode.bind(panels[type]),\r\n          getCode: panels[type].getCode.bind(panels[type]),\r\n          editor: mockEditor(panels[type].editor, [\r\n            'setCursor',\r\n            'getCursor',\r\n            'addKeyMap',\r\n            'on'\r\n          ])\r\n        };\r\n      });\r\n\r\n      return results;\r\n    }\r\n\r\n   // unnecessary? // lwf\r\n    if (isDOM(window.jsbin) || !window.jsbin || !window.jsbin.state) { // because...STUPIDITY!!!\r\n       window.jsbin = {\r\n        user: $.extend(true, {}, window.jsbin.user, jsbin.user),\r\n        'static': jsbin['static'],\r\n        version: jsbin.version,\r\n        analytics: jsbin.analytics,\r\n        state: {\r\n          title: jsbin.state.title,\r\n          description: jsbin.state.description\r\n        },\r\n        embed: jsbin.embed,\r\n        panels: {\r\n          // FIXME decide whether this should be locked down further\r\n          panels: mockPanels()\r\n        }\r\n      }; // create the holding object\r\n\r\n      if (jsbin.state.metadata && jsbin.user && jsbin.state.metadata.name === jsbin.user.name && jsbin.user.name) {\r\n        window.jsbin.settings = jsbin.settings;\r\n        return;\r\n      }\r\n\r\n      var key = 'o' + (Math.random() * 1).toString(32).slice(2);\r\n      Object.defineProperty(window, key, {\r\n        get:function () {\r\n          window.jsbin.settings = jsbin.settings;\r\n          console.log('jsbin.settings can now be modified on the console');\r\n        }\r\n      });\r\n      if (!jsbin.embed) {\r\n        console.log('To edit settings, type this string into the console: ' + key);\r\n      }\r\n    }\r\n  }\r\n  */\r\n\r\n  var storedSettings = store.localStorage.getItem('settings');\r\n  if (storedSettings === 'undefined' || jsbin.embed) {\r\n    // yes, equals the *string* 'undefined', then something went wrong\r\n    storedSettings = null;\r\n  }\r\n\r\n  // try to copy across statics\r\n  /*\r\n   // unnecessary? // lwf\r\n  ['root', 'shareRoot', 'runner', 'static', 'version'].map(function (key) {\r\n    if (!jsbin[key]) {\r\n      jsbin[key] = window.jsbin[key];\r\n    }\r\n  });\r\n  */\r\n  if (jsbin.user && jsbin.user.name) {\r\n    jsbin.settings = $.extend(true, {}, jsbin.user.settings, jsbin.settings);\r\n    if (jsbin.user.settings.font) {\r\n      jsbin.settings.font = parseInt(jsbin.user.settings.font, 10);\r\n    }\r\n  } else {\r\n    // In all cases localStorage takes precedence over user settings so users can\r\n    // configure it from the console and overwrite the server delivered settings\r\n    jsbin.settings = $.extend({}, jsbin.settings, JSON.parse(storedSettings || '{}'));\r\n  }\r\n\r\n  // if the above code isn't dodgy, this for hellz bells is:\r\n  jsbin.mobile = /WebKit.*Mobile.*|Android/.test(navigator.userAgent);\r\n  jsbin.tablet = /iPad/i.test(navigator.userAgent); // sue me.\r\n  // IE detect - sadly uglify is compressing the \\v1 trick to death :(\r\n  // via @padolsey & @jdalton - https://gist.github.com/527683\r\n  jsbin.ie = (function(){\r\n    var undef,\r\n        v = 3,\r\n        div = document.createElement('div'),\r\n        all = div.getElementsByTagName('i');\r\n    while (\r\n      div.innerHTML = '<!--[if gt IE ' + (++v) + ']><i></i><![endif]-->',\r\n      all[0]\r\n    ) {}\r\n    return v > 4 ? v : undef;\r\n  }());\r\n\r\n  if (!storedSettings && (location.origin + location.pathname) === jsbin.root + '/') {\r\n    // first timer - let's welcome them shall we, Dave?\r\n    store.localStorage.setItem('settings', '{}');\r\n  }\r\n\r\n  if (!jsbin.settings.editor) {\r\n    // backward compat with jsbin-v2\r\n    jsbin.settings.editor = {};\r\n  }\r\n\r\n  if (jsbin.settings.codemirror) {\r\n    $.extend(jsbin.settings.editor, jsbin.settings.codemirror);\r\n  }\r\n\r\n  if (jsbin.settings.editor.theme) {\r\n    $(document.documentElement).addClass('cm-s-' + jsbin.settings.editor.theme.split(' ')[0]);\r\n  }\r\n\r\n  // Add a pre-filter to all ajax requests to add a CSRF header to prevent\r\n  // malicious form submissions from other domains.\r\n  $.ajaxPrefilter(function (options, original, xhr) {\r\n    var skip = {head: 1, get: 1};\r\n    if (!skip[options.type.toLowerCase()] &&\r\n        !options.url.match(/^https:\\/\\/api.github.com/)) {\r\n      xhr.setRequestHeader('x-csrf-token', jsbin.state.token);\r\n    }\r\n  });\r\n\r\n  jsbin.owner = function () {\r\n    return jsbin.user && jsbin.user.name && jsbin.state.metadata && jsbin.state.metadata.name === jsbin.user.name;\r\n  };\r\n\r\n  jsbin.getURL = function (options) {\r\n    if (!options) { options = {}; }\r\n\r\n    var withoutRoot = options.withoutRoot;\r\n    var root = options.root || jsbin.root;\r\n    var url = withoutRoot ? '' : root;\r\n    var state = jsbin.state;\r\n\r\n    if (state.code) {\r\n      url += '/' + state.code;\r\n\r\n      if (!state.latest || options.withRevision) { //} && state.revision !== 1) {\r\n        if (options.withRevision !== false) {\r\n          url += '/' + (state.revision || 1);\r\n        }\r\n      }\r\n    }\r\n    return url;\r\n  };\r\n\r\n  jsbin.state.updateSettings = throttle(function updateBinSettingsInner(update, method) {\r\n    if (!method) {\r\n      method = 'POST';\r\n    }\r\n\r\n    if (jsbin.state.code) {\r\n      update.checksum = jsbin.state.checksum;\r\n      $.ajax({\r\n        type: method, // consistency ftw :-\\\r\n        url: jsbin.getURL({ withRevision: true }) + '/settings',\r\n        data: update\r\n      });\r\n    }\r\n  }, 500);\r\n\r\n\r\n  function objectValue(path, context) {\r\n    var props = path.split('.'),\r\n        length = props.length,\r\n        i = 1,\r\n        currentProp = context || window,\r\n        value = currentProp[path];\r\n    try {\r\n      if (currentProp[props[0]] !== undefined) {\r\n        currentProp = currentProp[props[0]];\r\n        for (; i < length; i++) {\r\n          if (currentProp[props[i]] === undefined) {\r\n            break;\r\n          } else if (i === length - 1) {\r\n            value = currentProp[props[i]];\r\n          }\r\n          currentProp = currentProp[props[i]];\r\n        }\r\n      }\r\n    } catch (e) {\r\n      value = undefined;\r\n    }\r\n\r\n    return value;\r\n  }\r\n\r\n\r\n  var $window = $(window),\r\n      $body = $('body'),\r\n      $document = $(document),\r\n      debug = jsbin.settings.debug === undefined ? false : jsbin.settings.debug,\r\n      documentTitle = 'JS Bin',\r\n      $bin = $('#bin'),\r\n      loadGist,\r\n      // splitterSettings = JSON.parse(store.localStorage.getItem('splitterSettings') || '[ { \"x\" : null }, { \"x\" : null } ]'),\r\n      unload = function () {\r\n        store.sessionStorage.setItem('url', jsbin.getURL());\r\n        store.localStorage.setItem('settings', JSON.stringify(jsbin.settings));\r\n\r\n        if (jsbin.panels.saveOnExit === false) {\r\n          return;\r\n        }\r\n\r\n        jsbin.panels.save();\r\n        jsbin.panels.savecontent();\r\n\r\n        var panel = jsbin.panels.focused;\r\n        if (panel) {\r\n          store.sessionStorage.setItem('panel', panel.id);\r\n        }\r\n      };\r\n\r\n  $window.unload(unload);\r\n\r\n  // window.addEventListener('storage', function (e) {\r\n  //   if (e.storageArea === localStorage && e.key === 'settings') {\r\n  //     console.log('updating from storage');\r\n  //     console.log(JSON.parse(store.localStorage.settings));\r\n  //     jsbin.settings = JSON.parse(store.localStorage.settings);\r\n  //   }\r\n  // });\r\n\r\n  // hack for Opera because the unload event isn't firing to capture the settings, so we put it on a timer\r\n  if ($.browser.opera) {\r\n    setInterval(unload, 500);\r\n  }\r\n\r\n  $document.one('jsbinReady', function () {\r\n    ///exposeSettings();\r\n    $bin.removeAttr('style');\r\n    $body.addClass('ready');\r\n  });\r\n\r\n  if (navigator.userAgent.indexOf(' Mac ') !== -1) {\r\n    (function () {\r\n    var el = $('#keyboardHelp')[0];\r\n    el.innerHTML = el.innerHTML.replace(/ctrl/g, 'cmd').replace(/Ctrl/g, 'ctrl');\r\n    })();\r\n  }\r\n\r\n  if (jsbin.embed) {\r\n    $window.on('focus', function () {\r\n      return false;\r\n    });\r\n  }\r\n\r\n  window.addEventListener('message', function (event) {\r\n    var data;\r\n    try {\r\n      data = JSON.parse(event.data);\r\n    } catch (e) {\r\n      return;\r\n    }\r\n\r\n    if (data.type === 'cached') {\r\n      if (data.updated > jsbin.state.metadata.last_updated || !jsbin.state.metadata.last_updated) {\r\n        console.log('restored from cache: %sms newer', (new Date(data.updated).getTime() - new Date(jsbin.state.metadata.last_updated).getTime()) / 100);\r\n        // update the bin\r\n        jsbin.panels.panels.html.setCode(data.template.html);\r\n        jsbin.panels.panels.javascript.setCode(data.template.javascript);\r\n        jsbin.panels.panels.css.setCode(data.template.css);\r\n        $('a.save:first').click();\r\n      }\r\n    }\r\n  });\r\n\r\n  (function() {\r\n    if (!jsbin.settings.debug) {\r\n      return;\r\n    }\r\n\r\n    var active = document.createElement('pre');\r\n    document.body.appendChild(active);\r\n    active.tabindex = -1;\r\n    objects.mixin(active.style, { // warning: `with` I know what I'm doing!\r\n      position : 'fixed',\r\n      padding : '2px',\r\n      bottom : '20px',\r\n      right : '20px',\r\n      margin : 0,\r\n      fontSize : 12,\r\n      color : '#fff',\r\n      background : '#aaa',\r\n      whiteSpace : 'pre-wrap',\r\n      maxWidth : '95%',\r\n      zIndex : 10000000,\r\n      pointerEvents : 'none'\r\n    });\r\n\r\n    var lastActive = null;\r\n    var showActive = function () {\r\n      var el = document.activeElement;\r\n      var html = '';\r\n      var attrs = el.attributes;\r\n      var i = 0;\r\n\r\n      if (el !== lastActive && el !== active) {\r\n        for (; i < attrs.length; i++) {\r\n          html += ' ' + attrs[i].name + '=\"' + attrs[i].value + '\"';\r\n        }\r\n\r\n        active.textContent = '<' + el.nodeName.toLowerCase() + html + '>';\r\n        lastActive = el;\r\n      }\r\n\r\n      requestAnimationFrame(showActive);\r\n    };\r\n\r\n    showActive();\r\n\r\n\r\n  })();\r\n\r\n  jsbin.$document = $document;\r\n  jsbin.$window = $window;\r\n  jsbin.throttle = throttle;\r\n  jsbin.escapeHTML = escapeHTML;\r\n\r\n\r\n  return jsbin;\r\n\r\n});\r\n\r\n\ndefine('skylark-jsbin-base/main',[\r\n\t\"./jsbin\"\r\n],function(jsbin){\r\n\treturn jsbin;\r\n});\ndefine('skylark-jsbin-base', ['skylark-jsbin-base/main'], function (main) { return main; });\n\n"]}